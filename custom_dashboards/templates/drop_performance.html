{% extends "base.html" %}
{% block content %}
<div class="container">
  <h1>Drop Performance Dashboard</h1>

  {% if error %}
    <div style="padding: 1rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem; color: #721c24; background-color: #f8d7da; border-color: #f5c6cb;">
      <strong>Error:</strong> {{ error }}
    </div>
  {% endif %}

  <label for="tagFilter">Filter by Product Tag:</label>
  <select id="tagFilter" class="form-select">
    <option value="">-- Select a tag --</option>
    {% for tag in tags %}
    <option value="{{ tag }}">{{ tag }}</option>
    {% endfor %}
  </select>

  <table id="resultsTable" class="data-table" style="display:none;">
    <thead>
      <tr>
        <th>Name</th>
        <th>Units Sold</th>
        <th>Revenue</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
document.getElementById("tagFilter").addEventListener("change", async (e) => {
  const tag = e.target.value;
  const table = document.getElementById("resultsTable");
  const tbody = table.querySelector("tbody");
  tbody.innerHTML = "";

  if (!tag) { table.style.display = "none"; return; }

  const res = await fetch(`/api/drop-performance?tag=${encodeURIComponent(tag)}`);
  const data = await res.json();

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.product_name}</td>
      <td>${row.units_sold}</td>
      <td>$${row.revenue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
    `;
    tbody.appendChild(tr);
  });

  table.style.display = "table";
});
</script>
{% endblock %}